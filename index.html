<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <title>SHELTER</title>
  <style>
    @keyframes glow { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }
    .glow { animation: glow 2s ease-in-out infinite; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .fadeIn { animation: fadeIn 0.3s ease-out; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
const { useState, useEffect } = React;

// –†–ê–°–¢–ï–ù–ò–Ø - –ú–ù–û–ì–û, –° –Æ–ú–û–†–û–ú
const PLANTS = {
  // üå± –ë–ê–ó–û–í–´–ï
  mushroom: { id: 'mushroom', name: '–ú—É—Ç–æ–≥—Ä–∏–±', icon: 'üçÑ', time: 2*60*60, food: 5, category: 'base', desc: '–ï—Å—Ç—å –∏—Ö –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è. –ù–æ –≤—ã–±–æ—Ä–∞ –Ω–µ—Ç.', cost: 10 },
  corn: { id: 'corn', name: '–ö—É–∫—É—Ä—É–∑–∞ "–°–ª–µ–ø–∞—è"', icon: 'üåΩ', time: 4*60*60, food: 8, rad: 2, category: 'base', desc: '–ù–∞–∑–≤–∞–Ω–∞ —Ç–∞–∫ –ø–æ—Ç–æ–º—É —á—Ç–æ —É –Ω–µ—ë –Ω–µ—Ç –≥–ª–∞–∑. –®—É—Ç–∫–∞. –ò–ª–∏ –Ω–µ—Ç.', cost: 20 },
  beet: { id: 'beet', name: '–°–≤—ë–∫–ª–∞ "–ü–æ—Å–ª–µ–¥–Ω—è—è"', icon: 'ü•î', time: 6*60*60, food: 15, sickChance: 0.1, category: 'base', desc: '–ú–Ω–æ–≥–æ –µ–¥—ã. –ò–Ω–æ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–µ—Ç —Ä–≤–æ—Ç—É. –ß–∞—â–µ —á–µ–º –∏–Ω–æ–≥–¥–∞.', cost: 35 },
  lichen: { id: 'lichen', name: '–õ–∏—à–∞–π–Ω–∏–∫ ‚Ññ7', icon: 'üåø', time: 1*60*60, food: 2, rad: -1, category: 'base', desc: '–°–Ω–∏–∂–∞–µ—Ç —Ä–∞–¥–∏–∞—Ü–∏—é. –í–∫—É—Å –∫–∞–∫ —É —Å—Ç–∞—Ä–æ–≥–æ –Ω–æ—Å–∫–∞.', cost: 15 },
  
  // ‚ò¢ –†–ê–î–ò–û–ê–ö–¢–ò–í–ù–´–ï
  glowshroom: { id: 'glowshroom', name: '–°–≤–µ—Ç–æ–≥—Ä–∏–±', icon: 'üîÜ', time: 3*60*60, food: 10, rad: 5, energy: 2, category: 'rad', desc: '–°–≤–µ—Ç–∏—Ç—Å—è –≤ —Ç–µ–º–Ω–æ—Ç–µ. –≠–Ω–µ—Ä–≥–µ—Ç–∏–∫ –æ—Ç –ø—Ä–∏—Ä–æ–¥—ã.', cost: 50 },
  radcorn: { id: 'radcorn', name: '–†–∞–¥–∫—É–∫—É—Ä—É–∑–∞', icon: '‚ò¢Ô∏è', time: 5*60*60, food: 12, rad: 8, category: 'rad', desc: '–í—ã—Ä–æ—Å–ª–∞ –≤–æ–∑–ª–µ —Ä–µ–∞–∫—Ç–æ—Ä–∞. –¢–µ–ø–µ—Ä—å –æ–Ω–∞ —á–∞—Å—Ç—å —Å–µ–º—å–∏.', cost: 80 },
  mutato: { id: 'mutato', name: '–ú—É—Ç–∞—Ç–æ', icon: 'ü•ï', time: 4*60*60, food: 14, mutateChance: 0.15, category: 'rad', desc: '–ö–∞—Ä—Ç–æ—à–∫–∞? –ú–æ—Ä–∫–æ–≤—å? –ö—Ç–æ –∑–Ω–∞–µ—Ç. –û–Ω–∞ —Å–∞–º–∞ –Ω–µ –∑–Ω–∞–µ—Ç.', cost: 60 },
  
  // üß™ –≠–ö–°–ü–ï–†–ò–ú–ï–ù–¢–ê–õ–¨–ù–´–ï
  brain_plant: { id: 'brain_plant', name: '–î—É–º–æ–≥—Ä–∏–±', icon: 'üß†', time: 8*60*60, food: 20, special: 'talks', category: 'exp', desc: '–ò–Ω–æ–≥–¥–∞ —à–µ–ø—á–µ—Ç. –û–±—ã—á–Ω–æ –∂–∞–ª—É–µ—Ç—Å—è –Ω–∞ –∂–∏–∑–Ω—å.', cost: 150 },
  crystal: { id: 'crystal', name: '–ö—Ä–∏—Å—Ç–∞–ª–ª "–ù–∞–¥–µ–∂–¥–∞"', icon: 'üíé', time: 10*60*60, food: 0, junk: 30, category: 'exp', desc: '–ù–µ —Å—ä–µ–¥–æ–±–µ–Ω. –ù–æ –∫—Ä–∞—Å–∏–≤—ã–π. –ë–µ—Å–ø–æ–ª–µ–∑–µ–Ω, –∫–∞–∫ –Ω–∞–¥–µ–∂–¥–∞.', cost: 200 },
  void_berry: { id: 'void_berry', name: '–ü—É—Å—Ç–æ—è–≥–æ–¥–∞', icon: '‚ö´', time: 6*60*60, food: 25, voidChance: 0.05, category: 'exp', desc: '–ò–Ω–æ–≥–¥–∞ –∏—Å—á–µ–∑–∞–µ—Ç –ø—Ä—è–º–æ –≤ —Ä—É–∫–∞—Ö. –í–º–µ—Å—Ç–µ —Å —Ä—É–∫–∞–º–∏.', cost: 120 },
  
  // ‚ò† –ó–ê–ü–†–ï–©–Å–ù–ù–´–ï
  dont_touch: { id: 'dont_touch', name: '–ü–ª–æ–¥ "–ù–ï –¢–†–û–ì–ê–¢–¨"', icon: 'üî¥', time: 12*60*60, food: 50, explodeChance: 0.2, category: 'forbidden', desc: '–ù–∞ —É–ø–∞–∫–æ–≤–∫–µ –Ω–∞–ø–∏—Å–∞–Ω–æ –ù–ï –¢–†–û–ì–ê–¢–¨. –ú—ã –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.', cost: 300 },
  screamer: { id: 'screamer', name: '–ö—Ä–∏–∫—É–Ω', icon: 'üò±', time: 7*60*60, food: 18, screamChance: 0.3, category: 'forbidden', desc: '–ö—Ä–∏—á–∏—Ç –∫–æ–≥–¥–∞ –µ–≥–æ —Å—Ä—ã–≤–∞–µ—à—å. –ü–æ—Ç–æ–º –∫—Ä–∏—á–∏—à—å —Ç—ã.', cost: 180 },
  last_hope: { id: 'last_hope', name: '–ü–æ—Å–ª–µ–¥–Ω—è—è –ù–∞–¥–µ–∂–¥–∞', icon: '‚ú®', time: 24*60*60, food: 100, rad: -10, category: 'forbidden', desc: '–†–∞—Å—Ç—ë—Ç —Å—É—Ç–∫–∏. –¢–æ–≥–æ —Å—Ç–æ–∏—Ç. –ù–∞–≤–µ—Ä–Ω–æ–µ.', cost: 500 }
};

// –°–û–ë–´–¢–ò–Ø –í–´–õ–ê–ó–û–ö
const EXPEDITION_EVENTS = [
  { text: '–ù–∞—à–ª–∏ —Å–∫–ª–∞–¥ —Å—Ç–∞—Ä—ã—Ö –∫–æ–Ω—Å–µ—Ä–≤–æ–≤. –°—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏ –∏—Å—Ç—ë–∫ –≤ 2015. –ë–µ—Ä—ë–º.', junk: 30, food: 5 },
  { text: '–î–µ—Ç—Å–∫–∞—è –ø–ª–æ—â–∞–¥–∫–∞. –î–µ—Ç–µ–π –Ω–µ—Ç. –•–ª–∞–º –µ—Å—Ç—å.', junk: 25 },
  { text: '–ü–æ–ø–∞–ª–∏ –ø–æ–¥ —Ä–∞–¥–∏–æ–∞–∫—Ç–∏–≤–Ω—ã–π –¥–æ–∂–¥—å. –¢–µ–ø–µ—Ä—å —Å–≤–µ—Ç–∏–º—Å—è.', rad: 5, junk: 10 },
  { text: '–í—Å—Ç—Ä–µ—Ç–∏–ª–∏ –¥—Ä—É–≥–æ–≥–æ –≤—ã–∂–∏–≤—à–µ–≥–æ. –û–Ω –ø–æ–ø—Ä–æ—Å–∏–ª –µ–¥—ã. –ú—ã –æ—Ç–∫–∞–∑–∞–ª–∏.', junk: 15 },
  { text: '–ù–∞—à–ª–∏ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π –Ω–∞–±–æ—Ä. –í–Ω—É—Ç—Ä–∏ –∞—Å–ø–∏—Ä–∏–Ω –∏ –∑–∞–ø–∏—Å–∫–∞ "—É–¥–∞—á–∏".', junk: 40 },
  { text: '–û–±–Ω–∞—Ä—É–∂–∏–ª–∏ –∑–∞–±—Ä–æ—à–µ–Ω–Ω—ã–π –±—É–Ω–∫–µ—Ä. –í–Ω—É—Ç—Ä–∏ —Å–∫–µ–ª–µ—Ç —Å —Ç–∞–±–ª–∏—á–∫–æ–π "–Ø –ó–ù–ê–õ".', junk: 50, rad: 3 },
  { text: '–ú—É—Ç–∏—Ä–æ–≤–∞–≤—à–∞—è –∫—Ä—ã—Å–∞ —Ä–∞–∑–º–µ—Ä–æ–º —Å —Å–æ–±–∞–∫—É. –£–±–µ–∂–∞–ª–∏. –û–Ω–∞ —Ç–æ–∂–µ —É–±–µ–∂–∞–ª–∞.', junk: 5 },
  { text: '–ù–∞—à–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä. –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç. –ù–æ –º—ã –≤—Å—ë —Ä–∞–≤–Ω–æ –µ–≥–æ —Ç–∞—â–∏–º.', junk: 60 },
  { text: '–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞. –í—Å–µ –∫–Ω–∏–≥–∏ —Å–≥–æ—Ä–µ–ª–∏. –ö—Ä–æ–º–µ "–ö–∞–∫ –ø–µ—Ä–µ–∂–∏—Ç—å –∞–ø–æ–∫–∞–ª–∏–ø—Å–∏—Å". –ò—Ä–æ–Ω–∏—è.', junk: 20 },
  { text: '–ë—ã–≤—à–∏–π –æ—Ñ–∏—Å. –ù–∞ —Å—Ç–æ–ª–µ –ª–µ–∂–∏—Ç –±–µ–π–¥–∂ "–õ—É—á—à–∏–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –º–µ—Å—è—Ü–∞". –ú–µ—Å—è—Ü - –º–∞–π 2077.', junk: 35 },
  { text: '–ê–ø—Ç–µ–∫–∞ —Ä–∞–∑–≥—Ä–∞–±–ª–µ–Ω–∞. –û—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ —Å—Ä–µ–¥—Å—Ç–≤–æ –æ—Ç –ø–µ—Ä—Ö–æ—Ç–∏. –ë–µ—Ä—ë–º.', junk: 15 },
  { text: '–í—ã–≤–µ—Å–∫–∞ "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –≥–æ—Ä–æ–¥ –ù–∞–¥–µ–∂–¥–∞". –ì–æ—Ä–æ–¥–∞ –Ω–µ—Ç.', junk: 45 },
  { text: '–ù–∞—à–ª–∏ –∑–∞–ø–∏—Å—å –Ω–∞ —Å—Ç–∞—Ä–æ–π —Ñ–ª–µ—à–∫–µ. –¢–∞–º –∫—Ç–æ-—Ç–æ –ø–æ—ë—Ç –∫–∞—Ä–∞–æ–∫–µ. –ü–ª–æ—Ö–æ –ø–æ—ë—Ç.', junk: 30 },
  { text: '–í—Å—Ç—Ä–µ—Ç–∏–ª–∏ —Ä–æ–±–æ—Ç–∞-—É–±–æ—Ä—â–∏–∫–∞. –û–Ω –¥–æ —Å–∏—Ö –ø–æ—Ä –º–µ—Ç—ë—Ç –ø–µ–ø–µ–ª.', junk: 40 },
  { text: '–ü–æ—Ç–µ—Ä—è–ª–∏ –≤—Å—ë. –ê–±—Å–æ–ª—é—Ç–Ω–æ –≤—Å—ë. –î–µ–Ω—å –∫–∞–∫ –¥–µ–Ω—å.', junk: 0, food: -5 }
];

// –£–õ–£–ß–®–ï–ù–ò–Ø
const UPGRADES = {
  farm_slots: { id: 'farm_slots', name: '+1 —Å–ª–æ—Ç —Ñ–µ—Ä–º—ã', desc: '–ë–æ–ª—å—à–µ —Ä–∞—Å—Ç–µ–Ω–∏–π = –±–æ–ª—å—à–µ –æ—Ç—á–∞—è–Ω–∏—è', cost: 100, maxLevel: 10 },
  water_cap: { id: 'water_cap', name: '+10 –≤–æ–¥—ã (–º–∞–∫—Å)', desc: '–¢–µ–ø–µ—Ä—å –º–æ–∂–µ–º —Ö—Ä–∞–Ω–∏—Ç—å –±–æ–ª—å—à–µ –≥—Ä—è–∑–Ω–æ–π –≤–æ–¥—ã', cost: 150, maxLevel: 5 },
  energy_cap: { id: 'energy_cap', name: '+10 —ç–Ω–µ—Ä–≥–∏–∏ (–º–∞–∫—Å)', desc: '–ß—Ç–æ–±—ã –¥–µ–ª–∞—Ç—å –±–æ–ª—å—à–µ –Ω–µ–Ω—É–∂–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π', cost: 200, maxLevel: 5 },
  rad_filter: { id: 'rad_filter', name: '–£–ª—É—á—à–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã', desc: '–†–∞–¥–∏–∞—Ü–∏—è –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è –º–µ–¥–ª–µ–Ω–Ω–µ–µ –Ω–∞ 10%', cost: 250, maxLevel: 3 },
  storage: { id: 'storage', name: '+50 —Å–∫–ª–∞–¥ —Ö–ª–∞–º–∞', desc: '–ë–æ–ª—å—à–µ –º–µ—Å—Ç–∞ –¥–ª—è –º—É—Å–æ—Ä–∞', cost: 120, maxLevel: 8 },
  faster_grow: { id: 'faster_grow', name: '–£—Å–∫–æ—Ä–µ–Ω–∏–µ —Ä–æ—Å—Ç–∞ -5%', desc: '–†–∞—Å—Ç–µ–Ω–∏—è —Ä–∞—Å—Ç—É—Ç —á—É—Ç—å –±—ã—Å—Ç—Ä–µ–µ. –ß—É—Ç—å.', cost: 300, maxLevel: 4 }
};

// SVG –∏–∫–æ–Ω–∫–∏
const X = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>;

function Shelter() {
  // –û–°–ù–û–í–ù–´–ï –†–ï–°–£–†–°–´
  const [radiation, setRadiation] = useState(10);
  const [energy, setEnergy] = useState(20);
  const [maxEnergy, setMaxEnergy] = useState(20);
  const [water, setWater] = useState(10);
  const [maxWater, setMaxWater] = useState(20);
  const [junk, setJunk] = useState(50);
  const [maxJunk, setMaxJunk] = useState(200);
  const [food, setFood] = useState(20);
  
  // –ò–ì–†–û–í–û–ï –°–û–°–¢–û–Ø–ù–ò–ï
  const [farmSlots, setFarmSlots] = useState([
    { id: 1, plant: null, startTime: null, status: 'empty' },
    { id: 2, plant: null, startTime: null, status: 'empty' }
  ]);
  const [expeditions, setExpeditions] = useState([]);
  const [upgrades, setUpgrades] = useState({});
  const [message, setMessage] = useState(null);
  const [currentScreen, setCurrentScreen] = useState('shelter'); // shelter, plant, expedition, upgrades
  const [selectedSlot, setSelectedSlot] = useState(null);
  const [logs, setLogs] = useState([
    { time: Date.now(), text: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —É–±–µ–∂–∏—â–µ. –ò–∑–≤–∏–Ω–∏—Ç–µ.' }
  ]);

  // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
  useEffect(() => {
    const interval = setInterval(() => saveGame(), 30000);
    return () => clearInterval(interval);
  }, [radiation, energy, water, junk, food, farmSlots, expeditions, upgrades]);

  // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
  useEffect(() => {
    loadGame();
    const energyInterval = setInterval(() => {
      setEnergy(prev => Math.min(prev + 1, maxEnergy));
    }, 60000); // +1 —ç–Ω–µ—Ä–≥–∏—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
    return () => clearInterval(energyInterval);
  }, []);

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–π–º–µ—Ä–æ–≤
  useEffect(() => {
    const interval = setInterval(() => {
      checkTimers();
    }, 1000);
    return () => clearInterval(interval);
  }, [farmSlots, expeditions]);

  const saveGame = async () => {
    try {
      const data = { radiation, energy, maxEnergy, water, maxWater, junk, maxJunk, food, farmSlots, expeditions, upgrades, logs };
      await window.storage.set('shelter_save', JSON.stringify(data));
    } catch (e) {}
  };

  const loadGame = async () => {
    try {
      const result = await window.storage.get('shelter_save');
      if (result?.value) {
        const data = JSON.parse(result.value);
        setRadiation(data.radiation || 10);
        setEnergy(data.energy || 20);
        setMaxEnergy(data.maxEnergy || 20);
        setWater(data.water || 10);
        setMaxWater(data.maxWater || 20);
        setJunk(data.junk || 50);
        setMaxJunk(data.maxJunk || 200);
        setFood(data.food || 20);
        setFarmSlots(data.farmSlots || farmSlots);
        setExpeditions(data.expeditions || []);
        setUpgrades(data.upgrades || {});
        setLogs(data.logs || logs);
        addLog('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ. –ù–∏—á–µ–≥–æ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å.');
      }
    } catch (e) {}
  };

  const addLog = (text) => {
    setLogs(prev => [{ time: Date.now(), text }, ...prev].slice(0, 50));
  };

  const showMsg = (text, duration = 2000) => {
    setMessage(text);
    setTimeout(() => setMessage(null), duration);
  };

  const checkTimers = () => {
    const now = Date.now();
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—Ç–µ–Ω–∏–π
    setFarmSlots(prev => prev.map(slot => {
      if (slot.status === 'growing' && slot.startTime) {
        const plant = PLANTS[slot.plant];
        const timeModifier = 1 + (radiation / 100); // –†–∞–¥–∏–∞—Ü–∏—è –∑–∞–º–µ–¥–ª—è–µ—Ç
        const totalTime = plant.time * 1000 * timeModifier;
        
        if (now - slot.startTime >= totalTime) {
          addLog(`${plant.name} –≤—ã—Ä–æ—Å. ${plant.desc}`);
          return { ...slot, status: 'ready' };
        }
      }
      return slot;
    }));

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–∫—Å–ø–µ–¥–∏—Ü–∏–π
    setExpeditions(prev => prev.map(exp => {
      if (exp.status === 'active' && now - exp.startTime >= exp.duration * 1000) {
        const event = EXPEDITION_EVENTS[Math.floor(Math.random() * EXPEDITION_EVENTS.length)];
        addLog(`–í—ã–ª–∞–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞: ${event.text}`);
        
        setJunk(j => Math.min(j + (event.junk || 0), maxJunk));
        setFood(f => Math.max(0, f + (event.food || 0)));
        setRadiation(r => Math.max(0, Math.min(100, r + (event.rad || 0))));
        
        return { ...exp, status: 'completed', event };
      }
      return exp;
    }));
  };

  const plantSeed = (plantId) => {
    if (!selectedSlot) return;
    const plant = PLANTS[plantId];
    
    if (junk < plant.cost) {
      showMsg('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ö–ª–∞–º–∞!');
      return;
    }
    if (water < 1) {
      showMsg('–ù—É–∂–Ω–∞ –≤–æ–¥–∞ –¥–ª—è –ø–æ—Å–∞–¥–∫–∏!');
      return;
    }

    setJunk(j => j - plant.cost);
    setWater(w => w - 1);
    setFarmSlots(prev => prev.map(slot => 
      slot.id === selectedSlot 
        ? { ...slot, plant: plantId, startTime: Date.now(), status: 'growing' }
        : slot
    ));
    
    addLog(`–ü–æ—Å–∞–¥–∏–ª–∏ ${plant.name}. ${plant.desc}`);
    setCurrentScreen('shelter');
    setSelectedSlot(null);
  };

  const harvest = (slotId) => {
    const slot = farmSlots.find(s => s.id === slotId);
    if (!slot || slot.status !== 'ready') return;
    
    const plant = PLANTS[slot.plant];
    let harvestedFood = plant.food || 0;
    let harvestedJunk = plant.junk || 0;
    let eventText = '';

    // –†–ê–ù–î–û–ú–ù–´–ï –°–û–ë–´–¢–ò–Ø –ø—Ä–∏ —Å–±–æ—Ä–µ
    const rand = Math.random();
    
    if (plant.explodeChance && rand < plant.explodeChance) {
      eventText = `${plant.name} –≤–∑–æ—Ä–≤–∞–ª—Å—è! –ü–æ—Ç–µ—Ä—è–ª–∏ –≤—Å—ë.`;
      harvestedFood = 0;
      harvestedJunk = 0;
      setRadiation(r => Math.min(100, r + 10));
    } else if (plant.mutateChance && rand < plant.mutateChance) {
      eventText = `${plant.name} –º—É—Ç–∏—Ä–æ–≤–∞–ª! –î–≤–æ–π–Ω–æ–π —É—Ä–æ–∂–∞–π!`;
      harvestedFood *= 2;
    } else if (plant.voidChance && rand < plant.voidChance) {
      eventText = `${plant.name} –∏—Å—á–µ–∑ –≤ –ø—É—Å—Ç–æ—Ç—É. –í–º–µ—Å—Ç–µ —Å –≤–∞—à–µ–π —Ä—É–∫–æ–π. –®—É—Ç–∫–∞. –ò–ª–∏ –Ω–µ—Ç.`;
      harvestedFood = 0;
    } else if (plant.screamChance && rand < plant.screamChance) {
      eventText = `${plant.name} –∑–∞–∫—Ä–∏—á–∞–ª –ø—Ä–∏ —Å–±–æ—Ä–µ. –í—ã —Ç–æ–∂–µ –∑–∞–∫—Ä–∏—á–∞–ª–∏.`;
    } else if (plant.special === 'talks') {
      const phrases = [
        '–î—É–º–æ–≥—Ä–∏–± –ø—Ä–æ—à–µ–ø—Ç–∞–ª: "–ó–∞—á–µ–º —Ç—ã –º–µ–Ω—è —Å—Ä—ã–≤–∞–µ—à—å?"',
        '–î—É–º–æ–≥—Ä–∏–± —Å–∫–∞–∑–∞–ª: "–ñ–∏–∑–Ω—å - –±–æ–ª—å."',
        '–î—É–º–æ–≥—Ä–∏–± –º–æ–ª—á–∏—Ç. –≠—Ç–æ —Ö—É–∂–µ.'
      ];
      eventText = phrases[Math.floor(Math.random() * phrases.length)];
    }

    setFood(f => f + harvestedFood);
    setJunk(j => Math.min(j + harvestedJunk, maxJunk));
    if (plant.rad) setRadiation(r => Math.max(0, Math.min(100, r + plant.rad)));
    if (plant.energy) setEnergy(e => Math.min(e + plant.energy, maxEnergy));
    
    setFarmSlots(prev => prev.map(s => 
      s.id === slotId 
        ? { ...s, plant: null, startTime: null, status: 'empty' }
        : s
    ));

    const finalText = eventText || `–°–æ–±—Ä–∞–ª–∏ ${plant.name}. +${harvestedFood} –µ–¥—ã.`;
    addLog(finalText);
    showMsg(finalText);
  };

  const startExpedition = (duration, cost) => {
    if (energy < cost) {
      showMsg('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏!');
      return;
    }

    setEnergy(e => e - cost);
    const newExp = {
      id: Date.now(),
      duration: duration * 60, // –º–∏–Ω—É—Ç—ã –≤ —Å–µ–∫—É–Ω–¥—ã
      startTime: Date.now(),
      status: 'active'
    };
    
    setExpeditions(prev => [...prev, newExp]);
    addLog(`–û—Ç–ø—Ä–∞–≤–∏–ª–∏—Å—å –Ω–∞ –≤—ã–ª–∞–∑–∫—É (${duration} –º–∏–Ω). –£–¥–∞—á–∏ –Ω–∞–º.`);
    setCurrentScreen('shelter');
  };

  const buyUpgrade = (upgradeId) => {
    const upgrade = UPGRADES[upgradeId];
    const currentLevel = upgrades[upgradeId] || 0;
    
    if (currentLevel >= upgrade.maxLevel) {
      showMsg('–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å!');
      return;
    }

    const cost = upgrade.cost * (currentLevel + 1);
    if (junk < cost) {
      showMsg('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ö–ª–∞–º–∞!');
      return;
    }

    setJunk(j => j - cost);
    setUpgrades(prev => ({ ...prev, [upgradeId]: currentLevel + 1 }));

    // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
    if (upgradeId === 'farm_slots') {
      setFarmSlots(prev => [...prev, { id: prev.length + 1, plant: null, startTime: null, status: 'empty' }]);
    } else if (upgradeId === 'water_cap') {
      setMaxWater(w => w + 10);
    } else if (upgradeId === 'energy_cap') {
      setMaxEnergy(e => e + 10);
    } else if (upgradeId === 'storage') {
      setMaxJunk(j => j + 50);
    }

    addLog(`–£–ª—É—á—à–µ–Ω–∏–µ: ${upgrade.name}. ${upgrade.desc}`);
  };

  const getTimeLeft = (startTime, duration) => {
    const elapsed = Date.now() - startTime;
    const remaining = Math.max(0, duration - elapsed);
    const minutes = Math.floor(remaining / 60000);
    const seconds = Math.floor((remaining % 60000) / 1000);
    return `${minutes}:${seconds.toString().padStart(2, '0')}`;
  };

  return (
    <div className="min-h-screen relative overflow-hidden bg-gradient-to-b from-gray-900 via-gray-800 to-black text-white">
      {/* –§–æ–Ω —Å —ç—Ñ—Ñ–µ–∫—Ç–æ–º —Ä–∞–¥–∏–∞—Ü–∏–∏ */}
      <div className="absolute inset-0 opacity-20">
        <div className="absolute top-0 left-0 w-full h-full" style={{
          background: `radial-gradient(circle at ${radiation}% 50%, rgba(0,255,0,0.3) 0%, transparent 50%)`
        }} />
      </div>

      <div className="relative z-10 p-4 max-w-2xl mx-auto">
        {/* HEADER */}
        <div className="mb-6 p-6 rounded-2xl border-2 border-orange-500 bg-gradient-to-r from-gray-900/90 to-gray-800/90 backdrop-blur-sm">
          <h1 className="text-3xl font-bold text-center mb-4 text-orange-400" style={{ fontFamily: 'monospace' }}>
            ‚ò¢ SHELTER ‚ò¢
          </h1>

          {/* –°—Ç–∞—Ç—É—Å—ã */}
          <div className="grid grid-cols-3 gap-2 mb-4">
            <div className="p-2 rounded-lg bg-black/40 border border-green-500/30">
              <div className="text-xs text-gray-400">‚ò¢ –†–∞–¥–∏–∞—Ü–∏—è</div>
              <div className="text-lg font-bold text-green-400">{radiation}%</div>
            </div>
            <div className="p-2 rounded-lg bg-black/40 border border-yellow-500/30">
              <div className="text-xs text-gray-400">‚ö° –≠–Ω–µ—Ä–≥–∏—è</div>
              <div className="text-lg font-bold text-yellow-400">{energy}/{maxEnergy}</div>
            </div>
            <div className="p-2 rounded-lg bg-black/40 border border-blue-500/30">
              <div className="text-xs text-gray-400">üíß –í–æ–¥–∞</div>
              <div className="text-lg font-bold text-blue-400">{water}/{maxWater}</div>
            </div>
          </div>

          <div className="grid grid-cols-2 gap-2">
            <div className="p-2 rounded-lg bg-black/40 border border-gray-500/30">
              <div className="text-xs text-gray-400">üß∞ –•–ª–∞–º</div>
              <div className="text-lg font-bold text-gray-300">{junk}/{maxJunk}</div>
            </div>
            <div className="p-2 rounded-lg bg-black/40 border border-red-500/30">
              <div className="text-xs text-gray-400">üçñ –ï–¥–∞</div>
              <div className="text-lg font-bold text-red-400">{food}</div>
            </div>
          </div>
        </div>

        {/* Message */}
        {message && (
          <div className="fixed top-4 left-1/2 transform -translate-x-1/2 z-50 fadeIn">
            <div className="px-6 py-3 rounded-lg bg-orange-500 text-black font-bold shadow-lg">
              {message}
            </div>
          </div>
        )}

        {/* –≠–ö–†–ê–ù: –£–ë–ï–ñ–ò–©–ï */}
        {currentScreen === 'shelter' && (
          <div className="space-y-4">
            {/* –ù–∞–≤–∏–≥–∞—Ü–∏—è */}
            <div className="grid grid-cols-3 gap-2">
              <button onClick={() => setCurrentScreen('shelter')} className="py-3 rounded-lg bg-orange-600 font-bold">
                üè† –£–±–µ–∂–∏—â–µ
              </button>
              <button onClick={() => setCurrentScreen('expedition')} className="py-3 rounded-lg bg-gray-700 font-bold hover:bg-gray-600">
                üéí –í—ã–ª–∞–∑–∫–∏
              </button>
              <button onClick={() => setCurrentScreen('upgrades')} className="py-3 rounded-lg bg-gray-700 font-bold hover:bg-gray-600">
                ‚öôÔ∏è –£–ª—É—á—à–µ–Ω–∏—è
              </button>
            </div>

            {/* –§–ï–†–ú–ê */}
            <div className="p-4 rounded-xl bg-gray-800/50 border border-green-500/30">
              <h2 className="text-xl font-bold mb-3 text-green-400">üå± –§–ï–†–ú–ê</h2>
              <div className="grid grid-cols-2 gap-2">
                {farmSlots.map(slot => {
                  const plant = slot.plant ? PLANTS[slot.plant] : null;
                  return (
                    <div key={slot.id} onClick={() => {
                      if (slot.status === 'empty') {
                        setSelectedSlot(slot.id);
                        setCurrentScreen('plant');
                      } else if (slot.status === 'ready') {
                        harvest(slot.id);
                      }
                    }} className="p-4 rounded-lg border-2 cursor-pointer hover:scale-105 transition-transform" style={{
                      background: slot.status === 'ready' ? 'rgba(0,255,0,0.1)' : slot.status === 'growing' ? 'rgba(255,165,0,0.1)' : 'rgba(255,255,255,0.05)',
                      borderColor: slot.status === 'ready' ? '#00ff00' : slot.status === 'growing' ? '#ffa500' : '#444'
                    }}>
                      {slot.status === 'empty' && (
                        <div className="text-center text-gray-500">
                          <div className="text-3xl mb-2">‚ûï</div>
                          <div className="text-xs">–ü–æ—Å–∞–¥–∏—Ç—å</div>
                        </div>
                      )}
                      {slot.status === 'growing' && plant && (
                        <div className="text-center">
                          <div className="text-3xl mb-1">{plant.icon}</div>
                          <div className="text-xs font-bold text-orange-400">{plant.name}</div>
                          <div className="text-xs text-gray-400 mt-1">
                            {getTimeLeft(slot.startTime, plant.time * 1000 * (1 + radiation / 100))}
                          </div>
                        </div>
                      )}
                      {slot.status === 'ready' && plant && (
                        <div className="text-center">
                          <div className="text-3xl mb-1 glow">{plant.icon}</div>
                          <div className="text-xs font-bold text-green-400">{plant.name}</div>
                          <div className="text-xs text-green-300 mt-1">‚úì –ì–æ—Ç–æ–≤–æ!</div>
                        </div>
                      )}
                    </div>
                  );
                })}
              </div>
            </div>

            {/* –ê–ö–¢–ò–í–ù–´–ï –≠–ö–°–ü–ï–î–ò–¶–ò–ò */}
            {expeditions.filter(e => e.status === 'active').length > 0 && (
              <div className="p-4 rounded-xl bg-gray-800/50 border border-yellow-500/30">
                <h2 className="text-xl font-bold mb-3 text-yellow-400">üéí –í–´–õ–ê–ó–ö–ò</h2>
                {expeditions.filter(e => e.status === 'active').map(exp => (
                  <div key={exp.id} className="p-3 rounded-lg bg-black/40 border border-yellow-500/50 mb-2">
                    <div className="text-sm text-gray-300">–í –ø—Ä–æ—Ü–µ—Å—Å–µ...</div>
                    <div className="text-lg font-bold text-yellow-400">
                      {getTimeLeft(exp.startTime, exp.duration * 1000)}
                    </div>
                  </div>
                ))}
              </div>
            )}

            {/* –õ–û–ì */}
            <div className="p-4 